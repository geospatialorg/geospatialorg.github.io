import useBaseUrl from '@docusaurus/useBaseUrl';

# JudeÈ›e, RomÃ¢nia (linie)

## Cod set de date

**`ro_admin_county_line`**

<figure style={{ textAlign: "center" }}>
  <img src={useBaseUrl('https://services.geo-spatial.org/data/thumbnails/administrative-boundaries/county/ro-admin-county-line.svg')} alt="Limite administrative - JudeÈ›e, RomÃ¢nia (linie)" />
</figure>

## Abordare practicÄƒ

Limitele judeÈ›elor din RomÃ¢nia, format vectorial/poligon, au fost descÄƒrcate de pe [geoportalul ANCPI](https://geoportal.ancpi.ro/portal/apps/webappviewer/index.html?id=faeba2d173374445b1f13512bd477bb2) Ã®n format Shapefile. Ulterior, au fost trecute printr-o procedurÄƒ automatÄƒ de procesare folosind un script (Bash - mediu *nix) ce este rulat dupÄƒ fiecare actualizare a datelor de la ANCPI. Pentru paÈ™ii de procesare, scriptul utilizeazÄƒ mai multe biblioteci open source È™i utilitare de sistem: [GDAL](https://gdal.org), [mapshaper](https://mapshaper.org/), [csvkit](https://csvkit.readthedocs.io/en/latest/), [curl](https://curl.se/), zip. Scriptul rezultat este prezentat Ã®n secÈ›iunea [Script ETL](#script-etl) È™i accesibil pentru descÄƒrcare pe pagina [GitHub](https://github.com/geospatialorg/ingestie-date/blob/main/publish_update_ro_admin_county_line.sh) a geo-spatial.org.

## Prelucrarea datelor

### Definirea corectÄƒ a proiecÈ›iei

Datele au venit cu o definiÈ›ie nestandardizatÄƒ a proiecÈ›iei:

>PROJCRS["Romania_double_stereo",BASEGEOGCRS["Pulkovo 1942",DATUM["Pulkovo 1942",ELLIPSOID["Krassowsky 1940",6378245,298.3,LENGTHUNIT["metre",1]],ID["EPSG",6284]],PRIMEM["Greenwich",0,ANGLEUNIT["Degree",0.0174532925199433]]],CONVERSION["unnamed",METHOD["Oblique Stereographic",ID["EPSG",9809]],PARAMETER["Latitude of natural origin",46,ANGLEUNIT["Degree",0.0174532925199433],ID["EPSG",8801]],PARAMETER["Longitude of natural origin",25,ANGLEUNIT["Degree",0.0174532925199433],ID["EPSG",8802]],PARAMETER["Scale factor at natural origin",0.99975,SCALEUNIT["unity",1],ID["EPSG",8805]],PARAMETER["False easting",500000,LENGTHUNIT["metre",1],ID["EPSG",8806]],PARAMETER["False northing",500000,LENGTHUNIT["metre",1],ID["EPSG",8807]]],CS[Cartesian,2],AXIS["(E)",east,ORDER[1],LENGTHUNIT["metre",1,ID["EPSG",9001]]],AXIS["(N)",north,ORDER[2],LENGTHUNIT["metre",1,ID["EPSG",9001]]]]

Aceasta a fost Ã®nlocuitÄƒ cu [EPSG:3844](https://epsg.io/3844).

### Eliminarea cÃ¢mpurilor cu informaÈ›ie redundantÄƒ

O serie din cÃ¢mpuri au fost considerate neimportante pentru utilizatorul obiÈ™nuit: `IFCID`, `localId`, `namespace`, `country`, `versionId`, `natLevel`, `beginVersion`, `endVersion`, `Shape_Leng`. Aceste cÃ¢mpuri, cum ar fi `namespace`, pot avea importanÈ›a lor Ã®n demersuri precum [Directiva INSPIRE](https://knowledge-base.inspire.ec.europa.eu/) dar, din punct de vedere practic, cÃ¢nd nu sunt exploatate Ã®ntr-un context de interoperabilitate cu date la nivel european, dar care, altfel, doar Ã®ncarcÄƒ inutil setul de date (au aceeaÈ™i valoare pentru toate entitÄƒÈ›ile din setul de date).

### AdÄƒugarea de cÃ¢mpuri noi

Din nomenclatorul [SIRUTA](http://80.96.186.4:81/senin/classifications.htm), publicat de [Institutul NaÈ›ional de StatisticÄƒ](https://insse.ro), au fost adÄƒugate o serie de cÃ¢mpuri suplimentare:

* `leftId` - codul SIRUTA al judeÈ›ului vecin 1 (extras din cÃ¢mpul original `localId`);
* `rightId` - codul SIRUTA al judeÈ›ului vecin 2 (extras din cÃ¢mpul original `localId`);
* `leftCounty` - numele judeÈ›ului vecin 1 (obÈ›inut prin join folosind codul SIRUTA);
* `rightCounty` - numele judeÈ›ului vecin 2 (obÈ›inut prin join folosind codul SIRUTA);

### Conversia Ã®n formate de fiÈ™ier populare

Datele au fost convertite Ã®n formatele de fiÈ™ier utilizate de geo-spatial.org pentru distribuirea de date vectoriale: `GeoPackage`, `Shapefile`, `Geoparquet`, `FlatGeobuf`, `GeoJSON`, `TopoJSON`, `KML`. Detalii despre motivaÈ›ia alegerii acestor formate È™i beneficiile fiecÄƒruia sunt prezentate Ã®n ghidul cu privire la date. De asemenea, pentru nevoi interne, datele au fost Ã®ncÄƒrcate Ã®n baza de date PostgreSQL/PostGIS.

### Publicare datelor

Datele au fost documentate Ã®n [Catalogul geo-spatial.org](https://services.geo-spatial.org/geonetwork/srv/eng/catalog.search#/metadata/9fa6e7ae-460b-47c0-bae8-bc81b7446386) È™i puse la dispoziÈ›ie pentru download/access prin protocolul HTTP È™i prin intermediul serviciilor standardizate OGC. Pentru mai multe detalii accesaÈ›i [Catalogul](https://services.geo-spatial.org/geonetwork/srv/eng/catalog.search#/metadata/9fa6e7ae-460b-47c0-bae8-bc81b7446386) È™i/sau secÈ›iunea <a href={useBaseUrl('descarcare/date/administrative-boundaries')}>DescÄƒrcare</a>. DefiniÈ›iile folosite pentru simbolizarea WMS a datelor au fost documentate Ã®n secÈ›iunea [Simbolizare SLD](#simbolizare-sld).

## Diagrama fluxului de lucru

<iframe
  src="https://geo-spatial.org/jsoncrack/editor/?json=https://geo-spatial.org/descrieri-etl-json/etl_ro_admin_county_line.json"
  width="100%"
  height="600"
  style={{ border: '1px solid #ccc', borderRadius: '8px' }}
  loading="lazy"
/>

<a
  href="https://geo-spatial.org/jsoncrack/editor/?json=https://geo-spatial.org/descrieri-etl-json/etl_ro_admin_county_line.json"
  target="_blank"
  rel="noopener noreferrer"
>
  Deschide diagrama Ã®ntr-o paginÄƒ separatÄƒ <i className="fa fa-external-link-alt" style={{ marginLeft: '0.3rem' }}></i>
</a>

## Script ETL

```bash title="publish_update_ro_admin_county_line.sh"
#!/usr/bin/zsh

##############################################################################################################
#ğŸ›  Publicare/actualizare JudeÈ›e, RomÃ¢nia (linie)
##############################################################################################################

#ğŸ› configuraÈ›ii

#ğŸ•¹ activare mediu Anaconda cu bibliotecile necesare pentru procesare
source /home/ubuntu/anaconda3/etc/profile.d/conda.sh
conda activate geo

#ğŸš definire cÄƒi date
ins_data_path="/storage/volumes/geoserver-1-storage/brute/institutii_romania/ins/siruta"
ancpi_data_path="/storage/volumes/geoserver-1-storage/brute/institutii_romania/ancpi/limite_administrative"
county_data_path="/storage/volumes/geoserver-1-storage/administrative_boundaries/county"
tmp_data_path="/storage/volumes/geoserver-1-storage/tmp"

#âš™ï¸ PostGIS
pg_host="localhost"
pg_port=5432
pg_user="user"
pg_db="geospatial"
pg_pass="pass"
pg_schema="romania"

#âš™ï¸ GeoServer
gs_url="http://localhost:8080/geoserver"
gs_user="user"
gs_pass="pass"
gs_workspace="administrative-boundaries"
gs_store="administrative-boundaries"
gs_layer_title="Limite administrative - judeÈ›e, RomÃ¢nia (linie)"
gs_layer_abstract="Set de date care conÈ›ine limitele oficiale ale judeÈ›elor din RomÃ¢nia, Ã®n format vectorial de tip linie, procesat de comunitatea geo-spatial.org pe baza datelor publice furnizate de AgenÈ›ia NaÈ›ionalÄƒ de Cadastru È™i Publicitate ImobiliarÄƒ. Versiunea curentÄƒ reflectÄƒ organizarea administrativ-teritorialÄƒ valabilÄƒ Ã®n RomÃ¢nia anului 2025."
gs_layer_keywords=("RomÃ¢nia" "judeÈ›e" "limite administrative" "vector" "linie")
gs_layer_metadata_link="https://services.geo-spatial.org/geonetwork/srv/eng/catalog.search#/metadata/9fa6e7ae-460b-47c0-bae8-bc81b7446386"
gs_layer_style="administrative-boundaries:ro_admin_county_line"

#âš™ï¸ Date
layer_name="ro_admin_county_line"

echo "
ğŸ›  Procesare JudeÈ›e, RomÃ¢nia (linie)
 "

echo "ğŸ’¾ ÃncÄƒrcare date Ã®n SQLite"

#ğŸ’¾ Ã®ncÄƒrcare SHP ANCPI Ã®n SQLite (se Ã®ncarcÄƒ È™i datele de tip poligon pentru join-ul ulterior)
ogr2ogr -of "SQLite" -a_srs "EPSG:3844" -lco LAUNDER=NO ${tmp_data_path}/judete.db ${ancpi_data_path}/Unitate_administrativa_judet.shp
ogr2ogr -of SQLite -append -a_srs "EPSG:3844" ${tmp_data_path}/judete.db ${ancpi_data_path}/Limita_administrativa_judet.shp

#ğŸ’¾ Ã®ncÄƒrcare tabel regiuni de dezvoltare Ã®n SQLite
csvsql --db sqlite:///${tmp_data_path}/judete.db --insert ${ins_data_path}/siruta_zone.csv

#ğŸ’¾ Ã®ncÄƒrcare tabel judeÈ›e Ã®n SQLITE
csvsql --db sqlite:///${tmp_data_path}/judete.db --insert ${ins_data_path}/siruta_judete.csv

#ğŸ’¾ creare tabel SQLite cu extragerea codurilor SIRUTA ale judeÈ›elor vecine unei limite din cÃ¢mpul localid È™i salvarea lor Ã®n cÃ¢mpurile leftId È™i rightId
sqlite3 ${tmp_data_path}/judete.db "CREATE TABLE split_siruta AS SELECT id, substr(localid, 1, instr(localid, '.') - 1) AS leftId, substr(localid, instr(localid, '.') + 1) AS rightId FROM Limita_administrativa_judet"

#ğŸ’¾ creare tabel pentru stratul de tip poligon (join cu SIRUTA)
ogr2ogr -of "SQLite" -append -dsco SPATIALITE=YES -lco LAUNDER=NO -a_srs EPSG:3844 -nln ro_admin_county_polygon -sql "SELECT a.OGC_FID AS id, CAST(b.jud AS INTEGER) AS countyId, CAST(b.siruta AS INTEGER) AS countyCode, b.denj AS name, b.mnemonic, CAST(c.zona AS INTEGER) AS regionId, CAST(c.siruta AS INTEGER)  AS regionCode, c.denzona AS region, CAST(b.FSJ AS INTEGER) AS sortCode, a.beginvers AS version, a.GEOMETRY FROM Unitate_administrativa_judet AS a LEFT JOIN siruta_judete AS b ON (a.natcode = b.siruta) LEFT JOIN siruta_zone AS c ON (b.zona=c.zona)" ${tmp_data_path}/judete.db ${tmp_data_path}/judete.db

#ğŸ’¾ creare tabel pentru stratul de tip linie (join cu SIRUTA È™i stratul poligon)
ogr2ogr -of "SQLite" -append -dsco SPATIALITE=YES -lco LAUNDER=NO -a_srs EPSG:3844 -nln ro_admin_county_line -sql "SELECT a.OGC_FID AS id, a.id, c.name AS leftCounty, d.name AS rightCounty, CAST(b.leftId AS INTEGER) AS leftId, CAST(b.rightId AS INTEGER) AS rightId, a.beginvers AS version, a.GEOMETRY FROM Limita_administrativa_judet AS a LEFT JOIN split_siruta AS b ON (a.id = b.id) LEFT JOIN ro_admin_county_polygon AS c ON (b.leftId=c.countycode) LEFT JOIN ro_admin_county_polygon AS d ON (b.rightId=d.countycode)" ${tmp_data_path}/judete.db ${tmp_data_path}/judete.db

#ğŸ’¾ creare versiune GeoPackage
echo creare versiune GeoPackage
if [ -f ${county_data_path}/ro_admin_county_line.gpkg ]; then
    rm ${county_data_path}/ro_admin_county_line.gpkg
fi
ogr2ogr -of GPKG -lco FID=id -a_srs EPSG:3844 -nlt MULTILINESTRING -nln ro_admin_county_line -dialect sqlite -sql "SELECT GEOMETRY AS geometry, * FROM ro_admin_county_line" ${county_data_path}/ro_admin_county_line.gpkg ${tmp_data_path}/judete.db

#ğŸ’¾ creare fiÈ™iere Esri Shapefile
echo "ğŸ’¾ creare fiÈ™iere Esri Shapefile"
if [ -f ${county_data_path}/ro_admin_county_line.zip ]; then
    rm ${county_data_path}/ro_admin_county_line.zip
fi
ogr2ogr -lco ENCODING=UTF-8 -nln ro_admin_county_line -dialect sqlite -sql "SELECT a.id AS id, * FROM ro_admin_county_line AS a" ${county_data_path}/ro_admin_county_line.shp ${county_data_path}/ro_admin_county_line.gpkg

#ğŸ“¦ arhivare fiÈ™iere shp
echo "ğŸ“¦ arhivare fiÈ™iere shp"
zip -j ${county_data_path}/ro_admin_county_line.zip ${county_data_path}/ro_admin_county_line.dbf ${county_data_path}/ro_admin_county_line.shp ${county_data_path}/ro_admin_county_line.prj ${county_data_path}/ro_admin_county_line.shx ${county_data_path}/ro_admin_county_line.cpg

#ğŸ’¾ creare versiune FlatGeobuf
echo "ğŸ’¾ creare versiune FlatGeobuf"
if [ -f ${county_data_path}/ro_admin_county_line.fgb ]; then
    rm ${county_data_path}/ro_admin_county_line.fgb
fi
ogr2ogr -of FlatGeobuf -nlt MULTILINESTRING -nln ro_admin_county_line -dialect sqlite -sql "SELECT a.id AS id, * FROM ro_admin_county_line AS a" ${county_data_path}/ro_admin_county_line.fgb ${county_data_path}/ro_admin_county_line.gpkg

#ğŸ’¾ creare versiune GeoParquet
echo "ğŸ’¾ creare versiune GeoParquet"
if [ -f ${county_data_path}/ro_admin_county_line.parquet ]; then
    rm ${county_data_path}/ro_admin_county_line.parquet
fi
ogr2ogr -of Parquet -nlt MULTILINESTRING -nln ro_admin_county_line -dialect sqlite -sql "SELECT a.id AS id, * FROM ro_admin_county_line AS a" ${county_data_path}/ro_admin_county_line.parquet ${county_data_path}/ro_admin_county_line.gpkg

#ğŸ’¾ creare versiune GeoJSON
echo "ğŸ’¾ creare versiune GeoJSON"
if [ -f ${county_data_path}/ro_admin_county_line.geojson ]; then
    rm ${county_data_path}/ro_admin_county_line.geojson
fi
ogr2ogr -of GeoJSON -t_srs EPSG:4326 -nln ro_admin_county_line -dialect sqlite -sql "SELECT a.id AS id, * FROM ro_admin_county_line AS a" ${county_data_path}/ro_admin_county_line.geojson ${county_data_path}/ro_admin_county_line.gpkg

#ğŸ’¾ creare versiune KML
echo "ğŸ’¾ creare versiune KML"
if [ -f ${county_data_path}/ro_admin_county_line.kml ]; then
    rm ${county_data_path}/ro_admin_county_line.kml
fi
ogr2ogr -of KML -t_srs EPSG:4326 -dsco NameField=name ${county_data_path}/ro_admin_county_line.kml ${county_data_path}/ro_admin_county_line.gpkg

#ğŸ’¾ creare versiune TopoJSON
echo "ğŸ’¾ creare versiune TopoJSON"
if [ -f ${county_data_path}/ro_admin_county_line.topojson ]; then
    rm ${county_data_path}/ro_admin_county_line.topojson
fi
mapshaper -i ${county_data_path}/ro_admin_county_line.shp -o format=topojson ${county_data_path}/ro_admin_county_line.topojson

#ğŸ’¾ actualizarea setului de date Ã®n baza de date PostGIS
echo "ğŸ’¾ actualizarea setului de date Ã®n baza de date PostGIS"
ogr2ogr -of PostgreSQL PG:"host=${pg_host} port=${pg_port} user=${pg_user} dbname=${pg_db} password=${pg_pass}" -lco schema=${pg_schema} -lco GEOMETRY_NAME=geom -lco overwrite=yes ${county_data_path}/${layer_name}.gpkg ${layer_name} -skipfailures -overwrite

#ğŸ–‡ indexare date PostGIS
psql -h ${pg_host} -p ${pg_port} -U ${pg_user} -d ${pg_db} -c "
CREATE INDEX ${layer_name}_geom_idx ON romania.${layer_name} USING GIST (geom);
CLUSTER romania.${layer_name} USING ${layer_name}_geom_idx;"

#ğŸ’¾ publicarea/actualizarea serviciilor de date
echo "ğŸ’¾ publicarea/actualizarea serviciilor de date"

#âŒ È™tergere strat existent (dacÄƒ existÄƒ)
echo "ğŸ” Verificare dacÄƒ existÄƒ stratul."
HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" -u $gs_user:$gs_pass \
  "${gs_url}/rest/layers/${gs_workspace}:${layer_name}.xml")

if [ "$HTTP_STATUS" == "200" ]; then
    echo "âš ï¸  Stratul existÄƒ. Se È™terge."
    curl -s -u $gs_user:$gs_pass -XDELETE \
      "${gs_url}/rest/layers/${gs_workspace}:${layer_name}?recurse=true"
    echo "ğŸ—‘ï¸  Stratul a fost È™ters."
else
    echo "âœ… Nu existÄƒ strat cu acest nume."
fi

#ğŸ’¾ creare strat
echo "â• Creare strat ${layer_name}"
curl -s -u $gs_user:$gs_pass -XPOST -H "Content-type: text/xml" \
  -d "<featureType>
         <name>${layer_name}</name>
         <nativeName>${layer_name}</nativeName>
         <title>${gs_layer_title}</title>
         <abstract>${gs_layer_abstract}</abstract>
     </featureType>" \
  "${gs_url}/rest/workspaces/${gs_workspace}/datastores/${gs_store}/featuretypes"

#ğŸ’¾ adÄƒugare detalii suplimentare (keywords È™i metadata link)
echo "ğŸ“ Actualizare metadate"
keywords_xml=""
for keyword in "${gs_layer_keywords[@]}"; do
    keywords_xml+="<string>${keyword}</string>"
done

curl -s -u $gs_user:$gs_pass -XPUT -H "Content-type: text/xml" \
-d "<featureType>
        <keywords>
            ${keywords_xml}
        </keywords>
        <metadataLinks>
            <metadataLink>
                <type>text/xml</type>
                <metadataType>ISO19115:2003</metadataType>
                <content>${gs_layer_metadata_link}</content>
            </metadataLink>
        </metadataLinks>
    </featureType>" \
"${gs_url}/rest/workspaces/${gs_workspace}/datastores/${gs_store}/featuretypes/${layer_name}"

#ğŸ’¾ Setare stil implicit + ataÈ™are stil suplimentar
echo "ğŸ¨ Setare stil implicit + ataÈ™are stil suplimentar..."
curl -s -u $gs_user:$gs_pass -XPUT -H "Content-type: text/xml" \
  -d "<layer>
         <defaultStyle>
             <name>${gs_layer_style##*:}</name>
         </defaultStyle>
     </layer>" \
  "${gs_url}/rest/layers/${gs_workspace}:${layer_name}"

echo "âœ… Stratul ${layer_name} a fost adÄƒugat È™i configurat cu succes Ã®n GeoServer."

#ğŸ—‘ï¸ È˜tergere fiÈ™iere intermediare
echo "ğŸ—‘ï¸ È˜tergere fiÈ™iere Shapefile"
rm ${county_data_path}/${layer_name}.dbf ${county_data_path}/${layer_name}.shp ${county_data_path}/${layer_name}.prj ${county_data_path}/${layer_name}.shx ${county_data_path}/${layer_name}.cpg ${tmp_data_path}/judete.db
```
Script accesibil È™i pe [GitHub](https://github.com/geospatialorg/ingestie-date/blob/main/publish_update_ro_admin_county_line.sh).

## Simbolizare SLD

### Simbolizare SLD implicitÄƒ

```xml title="ro_admin_county_line_labels.sld"
<?xml version="1.0" encoding="UTF-8"?>
<StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:se="http://www.opengis.net/se" version="1.1.0">
  <NamedLayer>
  <se:Name>JudeÈ›e</se:Name>
  <UserStyle>
    <se:Name>LimitÄƒ judeÈ›</se:Name>
    <se:FeatureTypeStyle>
      <se:Rule>
        <se:Name>LimitÄƒ judeÈ›</se:Name>
          <se:PolygonSymbolizer>
            <se:Stroke>
              <se:SvgParameter name="stroke">#b71540</se:SvgParameter>
              <se:SvgParameter name="stroke-width">2</se:SvgParameter>
              <se:SvgParameter name="stroke-linejoin">bevel</se:SvgParameter>
            </se:Stroke>
          </se:PolygonSymbolizer>
        </se:Rule>
      </se:FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor>
```
FiÈ™ier accesibil È™i pe [GitHub](https://github.com/geospatialorg/simbolizare/blob/main/sld/administrative-boundaries/ro_admin_county_line.sld).
